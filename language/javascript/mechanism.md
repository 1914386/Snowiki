# Mechanism

## API (Application Programming Interface)

사용자 인터페이스와 달리, 소프트웨어를 통해 상호 작용할 수 있도록 소프트웨어 프로그램 (애플리케이션) 내에 존재하는 기능 및 규칙의 집합

## 동작 원리

대부분의 프로그래밍 언어는 운영체제(Operating System, OS) 위에서 실행되지만 웹 애플리케이션의 자바스크립트는 브라우저에서 HTML, CSS와 함께 실행된다. 따라서 브라우저 환경을 고려할 때 보다 효율적인 자바스크립트 프로그래밍이 가능하다.

브라우저의 핵심 기능은 사용자가 참조하고자 하는 웹페이지를 서버에 요청(Request)하고 서버의 응답(Response)을 받아 브라우저에 표시하는 것이다. 브라우저는 서버로부터 HTML, CSS, Javascript, 이미지 파일 등을 응답받는다. HTML, CSS 파일은 **렌더링 엔진**의 HTML 파서와 CSS 파서에 의해 **파싱(Parsing)**되어 DOM, CSSOM 트리로 변환되고 렌더 트리로 결합된다. 이렇게 생성된 렌더 트리를 기반으로 브라우저는 웹페이지를 표시한다.

자바스크립트는 렌더링 엔진이 아닌 **자바스크립트 엔진**이 처리한다. HTML 파서는 script 태그를 만나면 자바스크립트 코드를 실행하기 위해 **DOM 생성 프로세스를 중지**하고 **자바스크립트 엔진으로 제어 권한을 넘긴다.** 제어 권한을 넘겨 받은 자바스크립트 엔진은 script 태그 내의 자바스크립트 코드 또는 script 태그의 src 어트리뷰트에 정의된 자바스크립트 파일을 로드하고 파싱하여 실행한다. 자바스크립트의 실행이 완료되면 다시 HTML 파서로 제어 권한을 넘겨서 브라우저가 중지했던 시점부터 DOM 생성을 재개한다.

이처럼 브라우저는 **동기(Synchronous)**적으로 HTML, CSS, Javascript을 처리한다. 이것은 script 태그의 위치에 따라 블로킹이 발생하여 DOM의 생성이 지연될 수 있다는 것을 의미한다. 따라서 script 태그의 위치는 중요한 의미를 갖는다.

## \<script> 선언 위치

* \<head> 태그 내부
  * 브라우저가 한 줄씩 읽다가(parsing) js 파일을 발견하면 중단하고 파일을 다운받은 후 다시 읽음
  * \-> 파일 크기가 클 경우 많은 시간 소요
* \<body> 태그 최하단
  * 브라우저가 다 읽고 js 파일 실행
  * \-> JS 의존적이라면 완전히 뜰 때까지 시간 소요
* async
  * boolean type, 기본 값은 true
  * 병렬로 js 파일 다운로드 받다가 완료되면 그 때 parsing을 멈추고 js 파일 실행 -> parsing 마저 실행
  * 정의된 순서에 상관 없이 먼저 다운받은 순서대로 실행
  * html이 parsing 완료되기도 전에 실행되므로 정의되지 않은 상태일 위험
* defer
  * 한 줄씩 읽다가 script defer 코드를 발견하면 병렬로 js 파일 다운로드
  * html parsing을 마친 후 js 파일 실행
  * 미리 다운받고 순서대로 실행
  * 순서 의존적인 경우 유용

※ 바닐라 자바스크립트를 사용할 경우 **'use strict'** 사용 권장
